<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Widget Medals - Federation Test</title>
    <style>
      #widget-container {
        display: block !important;
        visibility: visible !important;
        min-height: 100px !important;
        height: auto !important;
        opacity: 1 !important;
        padding: 10px;
      }
      .rt-widget {
        display: block !important;
        visibility: visible !important;
        min-height: 100px !important;
        height: auto !important;
        opacity: 1 !important;
        border: 2px solid red;
        padding: 10px;
      }
      .rt-widget-title {
        margin: 0 0 10px 0;
        padding: 0;
        font-size: 18px;
      }
      .rt-widget-content {
        padding: 10px;
        border: 1px solid #ccc;
      }
    </style>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  </head>
  <body>
    <div id="widget-container"></div>
    <script src="/widget-medals/federation/remoteEntry.js"></script>
    <script>
      async function loadWidget() {
        try {
          console.log('Starting widget load');
          
          // Initialize the container
          await window.medals_widget.init({
            react: { get: () => Promise.resolve(window.React) },
            'react-dom': { get: () => Promise.resolve(window.ReactDOM) }
          });
          console.log('Container initialized');

          // Get the widget module
          const factory = await window.medals_widget.get('./Widget');
          console.log('Got widget factory');
          
          const module = factory();
          console.log('Module loaded:', {
            exports: Object.keys(module),
            hasMount: typeof module.mount === 'function',
            hasWidget: typeof module.Widget === 'function'
          });

          // Mount the widget
          const container = document.getElementById('widget-container');
          const props = {
            title: 'Federation Widget',
            children: 'Testing Module Federation'
          };

          console.log('Mounting widget with props:', props);
          if (typeof module.mount === 'function') {
            module.mount(container, props);
            console.log('Widget mounted using mount function');
          } else if (typeof module.Widget === 'function') {
            const root = ReactDOM.createRoot(container);
            root.render(React.createElement(module.Widget, props));
            console.log('Widget mounted using Widget component');
          } else {
            throw new Error('No usable export found in module');
          }

        } catch (error) {
          console.error('Error loading widget:', error);
          console.error('Error details:', {
            error,
            stack: error.stack,
            React: !!window.React,
            ReactDOM: !!window.ReactDOM,
            medals_widget: !!window.medals_widget
          });
        }
      }

      // Load when React and ReactDOM are ready
      if (window.React && window.ReactDOM) {
        loadWidget();
      } else {
        window.addEventListener('load', loadWidget);
      }
    </script>
  </body>
</html> 